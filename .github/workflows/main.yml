name: Telegram Release Notifications

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Get current date
        id: get_date
        run: echo "current_date=$(date +'%Y-%m-%d %H:%M:%S')" >> $GITHUB_ENV

      - name: Process release notes
        id: process_release_notes
        run: |
          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è —Ä–µ–ª–∏–∑–∞:
          # –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –Ω–µ–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å "‚Ä¢ "
          RELEASE_BODY=$(echo "${{ github.event.release.body }}" | awk 'NR==1 { print } NR>1 { if($0 ~ /./) { print "‚Ä¢ " $0 } else { print } }')
          echo "release_body<<EOF" >> $GITHUB_ENV
          echo "${RELEASE_BODY}" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Get repository name
        id: get_repo_name
        run: echo "repo_name=${GITHUB_REPOSITORY##*/}" >> $GITHUB_ENV

      - name: Send message to Telegram
        uses: appleboy/telegram-action@master
        with:
          to: "-1002348215825"   # ID –≤–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞ –∏–ª–∏ —á–∞—Ç–∞
          token: "8196735240:AAHJ7VyISGE3eiwBxu74VlUMif7JPyX5OHY"
          format: HTML
          message: |
            üìå <b>–ù–æ–≤—ã–π —Ä–µ–ª–∏–∑ –≤ –ø—Ä–æ–µ–∫—Ç–µ:</b> ${{ env.repo_name }}
            üè∑Ô∏è <b>–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞:</b> ${{ github.event.release.name }} (<i>${{ github.event.release.tag_name }}</i>)
            üóìÔ∏è <b>–î–∞—Ç–∞:</b> ${{ env.current_date }}
            ‚úèÔ∏è <b>–û–ø–∏—Å–∞–Ω–∏–µ:</b>
            ${{ env.release_body }}
